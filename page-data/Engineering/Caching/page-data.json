{
    "componentChunkName": "component---node-modules-gatsby-theme-primer-wiki-src-templates-post-query-js",
    "path": "/Engineering/Caching/",
    "result": {"data":{"mdx":{"id":"4778df53-9e1c-5a27-861b-d2e56a2c67ae","tableOfContents":{"items":[{"url":"#cache-for-read","title":"Cache for read"},{"url":"#update-cache-on-writes","title":"Update Cache on Writes","items":[{"url":"#write-through-cache","title":"Write through Cache"},{"url":"#write-back-cache","title":"Write back Cache"}]},{"url":"#what-happens-if-we-have-many-servers-that-do-caches-","title":"What happens if we have many servers that do caches ?"},{"url":"#when-to-use-cache","title":"When to use cache"},{"url":"#cache-eviction","title":"Cache eviction"}]},"fields":{"title":"Cache for read","slug":"/Engineering/Caching/","url":"https://thomassajot.brain-dam.com/brain-dam/Engineering/Caching/","editUrl":"https://github.com/theowenyoung/obsidian-template-gatsby-theme-primer-wiki/tree/main/Engineering/Caching.md","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022","gitCreatedAt":"2022-02-03T13:24:53.000Z","shouldShowTitle":false},"frontmatter":{"title":"","description":null,"imageAlt":null,"tags":[],"date":null,"dateModified":null,"language":null,"seoTitle":null,"image":null},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"cache-for-read\"\n  }, \"Cache for read\"), mdx(\"h1\", {\n    \"id\": \"update-cache-on-writes\"\n  }, \"Update Cache on Writes\"), mdx(\"h2\", {\n    \"id\": \"write-through-cache\"\n  }, \"Write through Cache\"), mdx(\"p\", null, \"Have the cache and DB in sync when there is a write. Downside is that it takes time.\"), mdx(\"h2\", {\n    \"id\": \"write-back-cache\"\n  }, \"Write back Cache\"), mdx(\"p\", null, \"The server updates only the cache upon a write, then goes back to client. This makes the cache out of sync with the Database. The system will asynchronously update the DB. At every intervals, or when the cache is filled up (when you need to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"evict\"), \" the cache).  \"), mdx(\"p\", null, \"Downside: if something happens to the cache, before there is a write to DB, then you may loose data.\"), mdx(\"h1\", {\n    \"id\": \"what-happens-if-we-have-many-servers-that-do-caches-\"\n  }, \"What happens if we have many servers that do caches ?\"), mdx(\"p\", null, \"The first client writes a comment, it is cached to Server 1 and saved in DB. Client 2 reads the comment from another server 2, this server 2 caches the comments.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"The first clients updates the comment. How do we make sure the client 2 gets the new comments that is still cached in server 2 as the old text ? Caches can become \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"stale\"), \" if they have not been updated properly.\"), mdx(\"p\", null, \"For example, a solution would be to have a single cache (like \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/Engineering/Redis/\",\n    \"title\": \"Redis\"\n  }, \"Redis\"), \") out of the servers, that would be the single source of truth. \"), mdx(\"p\", null, \"For some features, we may not care about \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"staleness\"), \", for example view count on youtube videos.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-mermaid\"\n  }, \"graph LR\\nClient_1\\nClient_2\\nServer_1\\nServer_2\\nRedis\\nDatabase\\n\\nClient_1 --> Server_1\\nClient_2 --> Server_2\\nServer_1 --> Redis\\nServer_2 --> Redis\\n\\nRedis --- Database\\n\")), mdx(\"h1\", {\n    \"id\": \"when-to-use-cache\"\n  }, \"When to use cache\"), mdx(\"p\", null, \"If you deal with data that is immutable, caching is easy and great. If the data is mutable, that is a big work. \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"using Cache is you use immutable data. \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you have a single thing that read / write data then we can use cache\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you don't care about consistency / staleness of data, you can use caching\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you are able to design your system to get rid of stale data (in a distributed manner if your system uses it) then you can use cache\")), mdx(\"h1\", {\n    \"id\": \"cache-eviction\"\n  }, \"Cache eviction\"), mdx(\"p\", null, \"You cannot store infinite data, or you have stale data, you need to get rid of data in Caches (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"eviction\"), \").\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Using schedules / policies:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"LRU: Get rid of the Least Recently Used data in cache. \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Least frequently used: Remove the least frequently used\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"LIFO or FIFO\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Randomly\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Every day\")));\n}\n;\nMDXContent.isMDXComponent = true;","rawBody":"\n# Cache for read\n\n# Update Cache on Writes\n## Write through Cache\nHave the cache and DB in sync when there is a write. Downside is that it takes time.\n\n## Write back Cache\nThe server updates only the cache upon a write, then goes back to client. This makes the cache out of sync with the Database. The system will asynchronously update the DB. At every intervals, or when the cache is filled up (when you need to `evict` the cache).  \n\nDownside: if something happens to the cache, before there is a write to DB, then you may loose data.\n\n\n# What happens if we have many servers that do caches ?\nThe first client writes a comment, it is cached to Server 1 and saved in DB. Client 2 reads the comment from another server 2, this server 2 caches the comments.  \nThe first clients updates the comment. How do we make sure the client 2 gets the new comments that is still cached in server 2 as the old text ? Caches can become `stale` if they have not been updated properly.\n\nFor example, a solution would be to have a single cache (like [[Redis]]) out of the servers, that would be the single source of truth. \n\nFor some features, we may not care about `staleness`, for example view count on youtube videos.\n\n```mermaid \ngraph LR\nClient_1\nClient_2\nServer_1\nServer_2\nRedis\nDatabase\n\nClient_1 --> Server_1\nClient_2 --> Server_2\nServer_1 --> Redis\nServer_2 --> Redis\n\nRedis --- Database\n```\n\n# When to use cache\nIf you deal with data that is immutable, caching is easy and great. If the data is mutable, that is a big work. \n- using Cache is you use immutable data. \n- If you have a single thing that read / write data then we can use cache\n- If you don't care about consistency / staleness of data, you can use caching\n- If you are able to design your system to get rid of stale data (in a distributed manner if your system uses it) then you can use cache\n\n# Cache eviction\nYou cannot store infinite data, or you have stale data, you need to get rid of data in Caches (`eviction`).   \nUsing schedules / policies:\n- LRU: Get rid of the Least Recently Used data in cache. \n- Least frequently used: Remove the least frequently used\n- LIFO or FIFO\n- Randomly\n- Every day","excerpt":"Cache for read Update Cache on Writes Write through Cache Have the cache and DB in sync when there is a write. Downside is that it takes tiâ€¦","outboundReferences":[{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"An In memory Key-value store. Does offer some persistent storage options but is typically used as a really fast, best-effort caching solution.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Redis is also often used to implement \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/Engineering/Rate%20Limiting/\",\n    \"title\": \"Rate Limiting\"\n  }, \"Rate Limiting\"), \"\"));\n}\n;\nMDXContent.isMDXComponent = true;","fields":{"slug":"/Engineering/Redis/","title":"Redis","shouldShowTitle":true}}],"inboundReferences":[]},"tagsOutbound":{"nodes":[]}},"pageContext":{"tags":[],"slug":"/Engineering/Caching/","sidebarItems":[{"title":"Categories","items":[{"title":"Azure","url":"","items":[{"title":"Azure Pipeline","url":"/Azure/Azure pipeline/","items":[]},{"title":"Documentation","url":"/Azure/Azure-ml/","items":[]}]},{"title":"Brain Dam: Keeping information Upd","url":"/","items":[]},{"title":"Engineering","url":"","items":[{"title":"ACID","url":"/Engineering/Relational Databases/","items":[]},{"title":"API Design","url":"/Engineering/API Design/","items":[]},{"title":"Blob Store","url":"/Engineering/Specialized Storage Paradigms/","items":[]},{"title":"Cache for read","url":"/Engineering/Caching/","items":[]},{"title":"Client-Server Model","url":"/Engineering/Client-Server Model/","items":[]},{"title":"Configuration","url":"/Engineering/Configuration/","items":[]},{"title":"Consistent hashing with bounded load","url":"/Engineering/Consistent hashing/","items":[]},{"title":"Distributed Hash Table","url":"/Engineering/Distributed Hash Table/","items":[]},{"title":"Encryption","url":"/Engineering/Security and HTTPS/","items":[]},{"title":"Etcd","url":"/Engineering/Etcd/","items":[]},{"title":"Feature Flags","url":"/Engineering/Feature Flags/","items":[]},{"title":"Forward Proxy","url":"/Engineering/Proxies/","items":[]},{"title":"How does the load balancer work ?","url":"/Engineering/Load Balancer/","items":[]},{"title":"How to implement Leader election for your service ?","url":"/Engineering/Leader Election/","items":[]},{"title":"Idempotent Operation","url":"/Engineering/Idempotent Operation/","items":[]},{"title":"Important points","url":"/Engineering/MapReduce/","items":[]},{"title":"Latency","url":"/Engineering/Latency and Throughput/","items":[]},{"title":"Logging","url":"/Engineering/Logging and Monitoring/","items":[]},{"title":"Other strategy","url":"/Engineering/Jump hashing/","items":[]},{"title":"Other strategy","url":"/Engineering/Rendez-vous Hashing/","items":[]},{"title":"Polling","url":"/Engineering/Polling and Streaming/","items":[]},{"title":"Prometheus","url":"/Engineering/Prometheus/","items":[]},{"title":"Redis","url":"/Engineering/Redis/","items":[]},{"title":"Replication","url":"/Engineering/Replication and Sharding/","items":[]},{"title":"SLA / SLO","url":"/Engineering/Availability/","items":[]},{"title":"Socket","url":"/Engineering/Socket/","items":[]},{"title":"Storage Concept","url":"/Engineering/Storage concept/","items":[]},{"title":"Tools","url":"/Engineering/Key-Value Stores/","items":[]},{"title":"Tools","url":"/Engineering/Peer-To-Peer Networks/","items":[]},{"title":"Tools","url":"/Engineering/Publish-Subscribe Pattern/","items":[]},{"title":"Tools","url":"/Engineering/Rate Limiting/","items":[]},{"title":"Zookeeper","url":"/Engineering/Zookeeper/","items":[]}]},{"title":"ML","url":"","items":[{"title":"Constrained Optimization","url":"/ML/Constrained optimization/","items":[]},{"title":"Coordinate Descent","url":"/ML/Coordinate descent/","items":[]},{"title":"Determinant","url":"/ML/Determinant/","items":[]},{"title":"Dirichlet Distribution","url":"/ML/Dirichlet distribution/","items":[]},{"title":"Eigendecomposition","url":"/ML/Eigendecomposition/","items":[]},{"title":"Exploitation vs exploration","url":"/ML/Multi-armed bandit (AB testing)/","items":[]},{"title":"Frequentist A/B testing","url":"/ML/Frequentist AB testing/","items":[]},{"title":"Gradient","url":"/ML/Gradient/","items":[]},{"title":"Gradient Descend","url":"/ML/Gradient Descend/","items":[]},{"title":"Graph Neural Network","url":"/ML/GNN/","items":[]},{"title":"Hessian","url":"/ML/Hessian/","items":[]},{"title":"Jacobian","url":"/ML/Jacobian/","items":[]},{"title":"Kernel Trick","url":"/ML/Kernel Trick/","items":[]},{"title":"KKT conditions","url":"/ML/KKT/","items":[]},{"title":"Line Search","url":"/ML/Line Search/","items":[]},{"title":"Links","url":"/ML/Latent Dirichlet Allocation/","items":[]},{"title":"Maths","url":"/ML/PCA/","items":[]},{"title":"Matrix Inverse","url":"/ML/Matrix inverse/","items":[]},{"title":"Moore-Penrose Pseudoinverse","url":"/ML/Moore-Penrose Pseudoinverse/","items":[]},{"title":"Naive Bayes Classifier","url":"/ML/Naive Bayes Classifier/","items":[]},{"title":"Newton's Method","url":"/ML/Newton's method/","items":[]},{"title":"Norms","url":"/ML/Norms/","items":[]},{"title":"Overview","url":"/ML/RANSAC/","items":[]},{"title":"Parameter Estimation","url":"/ML/Parameter estimation/","items":[]},{"title":"Positive Definite Matrix","url":"/ML/Positive Definite Matrix/","items":[]},{"title":"Regression Losses","url":"/ML/Regression losses/","items":[]},{"title":"Singular Value Decomposition (SVD)","url":"/ML/Singular Value Decomposition (SVD)/","items":[]},{"title":"Symmetric Matrix","url":"/ML/Symmetric matrix/","items":[]},{"title":"Tool","url":"/ML/Bayesian AB testing/","items":[]},{"title":"Trace of Matrix","url":"/ML/Trace of matrix/","items":[]},{"title":"Trust Region","url":"/ML/trust region/","items":[]},{"title":"Variance and Standard Error","url":"/ML/Variance and Standard error/","items":[]}]},{"title":"Papers","url":"","items":[{"title":"Questions","url":"/Papers/VICREG  variance-invariance-covariance regulaization for self-supervised Learning/","items":[]}]},{"title":"Programming","url":"","items":[{"title":"Example problem: Min Rewards (hard pb)","url":"/Programming/Peak and Valleys/","items":[]}]},{"title":"Python","url":"","items":[{"title":"Dictionary","url":"/Python/Dictionary/","items":[]},{"title":"Is Python Compiled or Interpreted Language","url":"/Python/Is Python Compiled or Interpreted language/","items":[]},{"title":"Pkg Manager","url":"","items":[{"title":"Main Commands","url":"/Python/pkg manager/Conda/","items":[]},{"title":"Mamba","url":"/Python/pkg manager/Mamba/","items":[]},{"title":"PIP","url":"/Python/pkg manager/PIP/","items":[]}]}]},{"title":"Start Here","url":"/Start here/","items":[]},{"title":"Week 1","url":"/Coursera - Learning How to Learn/","items":[]}]}],"tagsGroups":[],"latestPosts":[{"fields":{"slug":"/Engineering/Distributed Hash Table/","title":"Distributed Hash Table","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Engineering/Feature Flags/","title":"Feature Flags","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Engineering/Prometheus/","title":"Prometheus","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/ML/Gradient Descend/","title":"Gradient Descend","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Coursera - Learning How to Learn/","title":"Week 1","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Azure/Azure pipeline/","title":"Azure Pipeline","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Azure/Azure-ml/","title":"Documentation","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Engineering/API Design/","title":"API Design","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Engineering/Availability/","title":"SLA / SLO","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}},{"fields":{"slug":"/Engineering/Caching/","title":"Cache for read","lastUpdatedAt":"2022-02-03T13:24:53.000Z","lastUpdated":"2/3/2022"},"frontmatter":{"draft":false,"tags":[]}}]}},
    "staticQueryHashes": ["2230547434","2320115945","3495835395","451533639"]}